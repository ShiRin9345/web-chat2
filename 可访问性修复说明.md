# 可访问性（Accessibility）修复说明

## 问题描述

在浏览器控制台中出现 Radix UI Dialog 组件的警告：

```
`DialogContent` requires a `DialogTitle` for the component to be accessible for screen reader users.
```

这是因为 Radix UI 的 Dialog 组件要求必须包含一个 `DialogTitle`，以便屏幕阅读器用户能够理解对话框的用途。

## 什么是可访问性（Accessibility）

可访问性是指让残障人士（特别是视力障碍者）也能够使用网站和应用的能力。屏幕阅读器会读出页面内容，帮助视力障碍者理解和操作界面。

对话框标题对于屏幕阅读器用户特别重要，因为它能告诉他们：
- 对话框的用途是什么
- 当前正在进行什么操作
- 如何与对话框交互

## 解决方案

### 方法：使用 `sr-only` 样式类隐藏标题

虽然我们的视频通话界面不需要显示标题（因为已经有视觉元素展示通话信息），但为了满足可访问性要求，我们添加了一个**视觉上隐藏但屏幕阅读器可见**的标题。

### 修改内容

#### 1. 添加 `sr-only` 工具类

**文件：** `packages/ui/src/styles/globals.css`

```css
@layer utilities {
  /* 屏幕阅读器可见，视觉隐藏 */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }
}
```

**说明：**
- `sr-only` 是 "screen reader only" 的缩写
- 这个样式会将元素在视觉上完全隐藏
- 但屏幕阅读器仍然能读取其内容
- 这是一个标准的 Web 可访问性实践

#### 2. 修改 VideoCallDialog 组件

**文件：** `apps/client/src/components/dialogs/VideoCallDialog.tsx`

```tsx
import { DialogTitle } from "@workspace/ui/components/dialog";

// 在 DialogContent 内添加隐藏标题
<DialogContent className="max-w-4xl h-[600px] p-0 overflow-hidden">
  {/* 隐藏的标题，用于屏幕阅读器 */}
  <DialogTitle className="sr-only">
    {callType === "video" ? "视频通话" : "语音通话"} - {friendName}
  </DialogTitle>
  
  <div className="relative w-full h-full bg-gray-900">
    {/* 其他内容... */}
  </div>
</DialogContent>
```

**效果：**
- 视觉用户：看不到标题，界面保持原样
- 屏幕阅读器用户：能听到 "视频通话 - 张三" 或 "语音通话 - 李四"

#### 3. 修改 IncomingCallDialog 组件

**文件：** `apps/client/src/components/dialogs/IncomingCallDialog.tsx`

```tsx
import { DialogTitle } from "@workspace/ui/components/dialog";

<DialogContent className="max-w-md">
  {/* 隐藏的标题，用于屏幕阅读器 */}
  <DialogTitle className="sr-only">
    {friendName} 来电 - {callType === "video" ? "视频通话" : "语音通话"}
  </DialogTitle>
  
  <div className="flex flex-col items-center justify-center py-8">
    {/* 其他内容... */}
  </div>
</DialogContent>
```

**效果：**
- 屏幕阅读器用户能听到 "张三 来电 - 视频通话"

## 为什么这样做

### 1. **符合 WCAG 标准**
Web Content Accessibility Guidelines (WCAG) 是国际公认的 Web 可访问性标准。添加对话框标题符合 WCAG 2.1 的要求。

### 2. **不影响视觉设计**
使用 `sr-only` 类，视觉用户完全看不到标题，界面保持原有设计。

### 3. **改善用户体验**
为使用屏幕阅读器的用户提供更好的体验，让他们也能轻松使用视频通话功能。

### 4. **消除警告**
解决了 Radix UI 的警告，保持代码质量。

## 测试验证

### 视觉测试
1. 打开视频通话对话框
2. ✅ 界面应该与之前完全一样，看不到标题

### 屏幕阅读器测试（可选）

如果你想测试屏幕阅读器功能：

**macOS：**
1. 打开 VoiceOver：Command + F5
2. 打开视频通话对话框
3. VoiceOver 会读出："视频通话 - [好友名称]"

**Windows：**
1. 打开 NVDA 或 JAWS 屏幕阅读器
2. 打开视频通话对话框
3. 听到对话框标题的朗读

### 控制台验证
1. 打开浏览器控制台（F12）
2. 发起视频通话
3. ✅ 不应该再看到 `DialogContent` requires a `DialogTitle` 警告

## 其他可访问性最佳实践

本次修复只是可访问性的一部分，以下是其他一些建议（暂未实现）：

1. **键盘导航**
   - 确保所有按钮都可以通过 Tab 键访问
   - 使用 Enter 或 Space 键激活按钮

2. **ARIA 标签**
   - 为按钮添加 `aria-label` 属性
   - 例如：`<Button aria-label="静音">...</Button>`

3. **焦点管理**
   - 对话框打开时，焦点应该移到对话框内
   - 关闭后，焦点应该返回触发按钮

4. **颜色对比度**
   - 确保文字和背景的对比度符合 WCAG 标准
   - 最小对比度 4.5:1（普通文字）

## 总结

通过添加隐藏的对话框标题，我们：
- ✅ 解决了 Radix UI 的警告
- ✅ 提升了应用的可访问性
- ✅ 不影响现有的视觉设计
- ✅ 为残障用户提供了更好的体验

这是一个小改动，但对依赖辅助技术的用户来说意义重大！
